<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Football Grader - Pro Player Profiles & Blogs</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <style>
    /* Reset and base */
    *, *::before, *::after {
      box-sizing: border-box;
    }
    html {
      font-family: 'Inter', sans-serif;
      font-size: 16px;
      scroll-behavior: smooth;
      background: #ffffff;
      color: #374151; /* Neutral gray 700 */
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      min-height: 100vh;
      -webkit-text-size-adjust: 100%;
    }
    body {
      margin: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      background: #f9fafb;
      color: #374151;
    }

    /* Container centered max width */
    .container {
      margin: 0 auto;
      max-width: 1200px;
      padding-left: 24px;
      padding-right: 24px;
      width: 100%;
    }

    /* Header */
    header {
      position: sticky;
      top: 0;
      background: #ffffff;
      box-shadow: 0 2px 6px rgb(0 0 0 / 0.08);
      z-index: 1000;
      padding: 12px 0;
    }
    .header-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 24px;
    }
    .logo {
      font-weight: 800;
      font-size: 1.75rem;
      color: #1f2937; /* Gray 800 */
      user-select: none;
      letter-spacing: -0.03em;
      cursor: default;
    }
    nav {
      display: flex;
      gap: 24px;
    }
    nav button, nav a {
      background: none;
      border: none;
      padding: 8px 10px;
      font-size: 1rem;
      font-weight: 600;
      color: #4b5563; /* Gray 600 */
      cursor: pointer;
      border-radius: 8px;
      text-decoration: none;
      transition: background-color 0.25s ease, color 0.25s ease;
    }
    nav button:hover, nav a:hover,
    nav button[aria-pressed="true"], nav a[aria-current="page"] {
      background-color: #4f46e5; /* Indigo 600 */
      color: white;
    }
    nav button:focus-visible, nav a:focus-visible {
      outline: 3px solid #4f46e5;
      outline-offset: 2px;
    }

    /* Main area */
    main {
      flex: 1 0 auto;
      padding: 40px 0 80px 0;
      background: #f9fafb;
      min-height: calc(100vh - 64px - 64px);
    }

    /* Footer */
    footer {
      background: #111827; /* Gray 900 */
      color: #e5e7eb; /* Gray 200 */
      padding: 32px 0;
      text-align: center;
      font-size: 0.875rem;
      user-select: none;
    }

    /* Layout for content area: tabs */
    .tab-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 24px;
    }

    /* Player Cards */
    .player-list {
      display: grid;
      gap: 32px;
      grid-template-columns: repeat(auto-fit,minmax(320px,1fr));
    }
    .player-card {
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgb(0 0 0 / 0.06);
      display: flex;
      flex-direction: column;
      padding: 24px;
      transition: box-shadow 0.3s ease;
    }
    .player-card:hover {
      box-shadow: 0 12px 24px rgb(0 0 0 / 0.12);
    }
    .player-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 16px;
    }
    .player-image {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #4f46e5; /* Indigo 600 */
      flex-shrink: 0;
    }
    .player-info {
      flex: 1;
    }
    .player-name {
      font-weight: 700;
      font-size: 1.25rem;
      line-height: 1.2;
      margin: 0;
      color: #1f2937;
    }
    .player-grade {
      font-weight: 800;
      font-size: 1.125rem;
      color: #6366f1; /* Indigo 400 */
      margin-top: 4px;
      user-select: none;
    }
    .threat-level {
      display: inline-flex;
      align-items: center;
      font-weight: 600;
      font-size: 1rem;
      border-radius: 12px;
      padding: 4px 12px;
      user-select: none;
      gap: 6px;
      color: white;
      white-space: nowrap;
    }
    /* Threat colors */
    .threat-god {
      background-color: #facc15; /* Yellow-400 */
      color: #713f12;
    }
    .threat-dragon {
      background-color: #ef4444; /* Red-500 */
    }
    .threat-demon {
      background-color: #ec4899; /* Pink-500 */
    }
    .threat-tiger {
      background-color: #f97316; /* Orange-500 */
    }
    .threat-wolf {
      background-color: #10b981; /* Emerald-500 */
    }

    /* Attributes grid */
    .player-attributes {
      display: grid;
      grid-template-columns: repeat(auto-fill,minmax(140px,1fr));
      gap: 12px 24px;
      margin: 20px 0 16px 0;
    }
    .attribute {
      background: #f3f4f6; /* Gray 100 */
      border-radius: 10px;
      padding: 12px 16px;
      font-size: 0.9rem;
      font-weight: 600;
      color: #374151; /* Gray 700 */
      user-select: none;
    }
    .attribute-label {
      font-weight: 400;
      font-size: 0.75rem;
      color: #6b7280; /* Gray 500 */
      display: block;
      margin-bottom: 4px;
      user-select: text;
    }

    /* Skills and shooting skills displayed as tags */
    .skills-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .skill-tag {
      background: #e0e7ff; /* Indigo-100 */
      border-radius: 16px;
      padding: 6px 14px;
      font-weight: 600;
      font-size: 0.85rem;
      color: #3730a3; /* Indigo-900 */
      user-select: text;
      cursor: default;
      white-space: nowrap;
    }

    /* Comments section */
    .comments-section {
      margin-top: 24px;
      border-top: 1px solid #e5e7eb;
      padding-top: 16px;
    }
    .comments-title {
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 12px;
      color: #1f2937;
      user-select: none;
    }
    .comment-list {
      max-height: 160px;
      overflow-y: auto;
      margin-bottom: 12px;
      padding-right: 4px;
    }
    .comment-item {
      background: #f3f4f6;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 0.9rem;
      margin-bottom: 8px;
      color: #374151;
      user-select: text;
      white-space: pre-wrap;
      word-wrap: break-word;
      box-shadow: inset 0 0 3px rgb(0 0 0 / 0.05);
    }
    .comment-form {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .comment-form textarea {
      flex: 1;
      resize: vertical;
      min-height: 40px;
      max-height: 90px;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-family: 'Inter', sans-serif;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    .comment-form textarea:focus {
      outline: none;
      border-color: #4f46e5;
      box-shadow: 0 0 6px #a5b4fc;
    }
    .comment-form button {
      background-color: #4f46e5;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      color: white;
      font-weight: 700;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease;
      font-size: 1rem;
    }
    .comment-form button:hover:enabled {
      background-color: #4338ca;
    }
    .comment-form button:disabled {
      background-color: #a5b4fc;
      cursor: not-allowed;
    }

    /* Blog section */
    .blog-list {
      display: flex;
      flex-direction: column;
      gap: 32px;
      max-width: 800px;
      margin: 0 auto;
    }
    .blog-post {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgb(0 0 0 / 0.06);
    }
    .blog-title {
      font-weight: 800;
      font-size: 1.75rem;
      margin-bottom: 12px;
      color: #1f2937;
    }
    .blog-date {
      font-size: 0.85rem;
      color: #6b7280;
      margin-bottom: 16px;
      user-select: none;
    }
    .blog-content {
      font-size: 1rem;
      line-height: 1.6;
      color: #374151;
      white-space: pre-line;
      user-select: text;
      margin-bottom: 12px;
    }
    .blog-image-container {
      margin-top: 16px;
      text-align: center;
    }
    .blog-image {
      max-width: 100%;
      border-radius: 12px;
      object-fit: contain;
      box-shadow: 0 6px 12px rgb(0 0 0 / 0.1);
    }

    /* Admin area */
    .admin-panel {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
      background: #f3f4f6;
      border-radius: 12px;
      box-shadow: 0 6px 12px rgb(0 0 0 / 0.07);
    }
    .admin-title {
      font-weight: 800;
      font-size: 1.5rem;
      margin-bottom: 24px;
      color: #1f2937;
      user-select: none;
    }
    .admin-section {
      margin-bottom: 32px;
    }
    .admin-section h3 {
      font-weight: 700;
      font-size: 1.25rem;
      margin-bottom: 16px;
      user-select: none;
    }

    /* Form elements */
    .form-group {
      margin-bottom: 16px;
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
      user-select: none;
    }
    input[type="text"],
    input[type="number"],
    input[type="file"],
    select,
    textarea {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-family: 'Inter', sans-serif;
      font-size: 1rem;
      resize: vertical;
      transition: border-color 0.3s ease;
    }
    input[type="text"]:focus,
    input[type="number"]:focus,
    input[type="file"]:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #4f46e5;
      box-shadow: 0 0 6px #a5b4fc;
    }
    textarea {
      min-height: 80px;
      max-height: 200px;
    }
    button.btn-primary, button.btn-danger, button.btn-secondary {
      cursor: pointer;
      border-radius: 8px;
      padding: 12px 22px;
      font-weight: 600;
      font-size: 1rem;
      transition: background-color 0.3s ease;
      user-select: none;
      border: none;
    }
    button.btn-primary {
      background: #4f46e5;
      color: white;
    }
    button.btn-primary:hover {
      background: #4338ca;
    }
    button.btn-secondary {
      background: #6b7280;
      color: white;
    }
    button.btn-secondary:hover {
      background: #4b5563;
    }
    button.btn-danger {
      background: #ef4444;
      color: white;
    }
    button.btn-danger:hover {
      background: #b91c1c;
    }
    .btn-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    /* Editable lists style */
    .list-item {
      background: white;
      box-shadow: inset 0 0 3px rgb(0 0 0 / 0.06);
      border-radius: 10px;
      padding: 12px 16px;
      margin-bottom: 12px;
      display: flex;
      gap: 12px;
      align-items: center;
    }
    .list-item > div {
      flex: 1 1 auto;
      display: flex;
      flex-direction: column;
    }
    .list-item label {
      font-weight: 600;
      font-size: 0.875rem;
      margin-bottom: 4px;
    }
    .list-item input,
    .list-item textarea,
    .list-item select {
      font-size: 0.9rem;
      resize: vertical;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      padding: 6px 10px;
      background: #f9fafb;
    }
    .list-item textarea {
      min-height: 50px;
    }
    .list-item-actions {
      display: flex;
      flex-direction: column;
      gap: 8px;
      flex-shrink: 0;
      justify-content: center;
    }
    .icon-button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 6px;
      color: #6b7280;
      transition: color 0.3s ease;
      border-radius: 6px;
    }
    .icon-button:hover {
      color: #ef4444;
      background: #ffeaea;
    }
    /* Icon sizes for better UI */
    .material-icons {
      font-size: 20px;
      user-select: none;
    }

    /* Responsive header navigation for mobile */
    @media (max-width: 640px) {
      .header-inner {
        padding: 0 16px;
      }
      nav {
        gap: 12px;
      }
      nav button, nav a {
        padding: 8px 6px;
        font-size: 0.9rem;
      }
      .container {
        padding-left: 16px;
        padding-right: 16px;
      }
      main {
        padding: 24px 0 64px;
      }
    }

    /* Rich text editing for blog posts */
    .content-editable {
      background: #fff;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      padding: 16px;
      min-height: 120px;
      font-family: 'Inter', sans-serif;
      font-size: 1rem;
      line-height: 1.5;
      color: #374151;
      overflow-y: auto;
      outline: none;
      margin-bottom: 12px;
    }
    .content-editable:empty::before {
      content: attr(data-placeholder);
      color: #9ca3af;
      font-style: italic;
      user-select: none;
    }

  </style>
</head>
<body>
  <header role="banner">
    <div class="header-inner">
      <div class="logo" aria-label="Football Grader Website">Football Grader</div>
      <nav role="navigation" aria-label="Primary">
        <button type="button" aria-pressed="true" id="btn-players" aria-controls="players-section" aria-haspopup="true">Players</button>
        <button type="button" aria-pressed="false" id="btn-blogs" aria-controls="blogs-section" aria-haspopup="true">Blogs</button>
        <button type="button" aria-pressed="false" id="btn-admin" aria-controls="admin-section" aria-haspopup="true">Admin</button>
      </nav>
    </div>
  </header>

  <main>
    <section id="players-section"  class="tab-content" role="region" aria-live="polite" aria-label="Player Profiles">
      <div class="player-list" id="player-list" tabindex="0" aria-label="List of players">
        <!-- Player cards inserted here -->
      </div>
    </section>

    <section id="blogs-section" class="tab-content" role="region" aria-live="polite" aria-label="Blog posts" hidden>
      <div class="blog-list" id="blog-list" tabindex="0" aria-label="List of blog posts">
        <!-- Blog posts inserted here -->
      </div>
    </section>

    <section id="admin-section" class="tab-content" role="region" aria-live="polite" aria-label="Admin panel" hidden>
      <!-- Admin Login -->
      <div id="admin-login-container" style="max-width: 380px; margin: 0 auto;">
        <h2 class="admin-title">Admin Login</h2>
        <form id="admin-login-form" aria-label="Admin login form">
          <div class="form-group">
            <label for="admin-password">Enter Admin Password:</label>
            <input id="admin-password" type="password" autocomplete="current-password" aria-required="true" aria-describedby="admin-password-desc" />
            <small id="admin-password-desc" style="color:#6b7280;">Admin password is required to access editing features.</small>
          </div>
          <button type="submit" class="btn-primary" aria-label="Login as admin">Login</button>
        </form>
      </div>

      <!-- Admin Panel Content (Shown after login) -->
      <div id="admin-panel-content" style="display:none;">
        <h2 class="admin-title">Admin Panel</h2>

        <section class="admin-section" aria-label="Manage Players">
          <h3>Manage Players</h3>
          <button id="btn-add-player" class="btn-primary" type="button" aria-label="Add new player">+ Add New Player</button>
          <div id="admin-player-list" style="margin-top: 16px;">
            <!-- Editable list of players here -->
          </div>
        </section>

        <section class="admin-section" aria-label="Manage Blogs">
          <h3>Manage Blogs</h3>
          <button id="btn-add-blog" class="btn-primary" type="button" aria-label="Add new blog post">+ Add New Blog</button>
          <div id="admin-blog-list" style="margin-top: 16px;">
            <!-- Editable list of blogs here -->
          </div>
        </section>

        <section class="admin-section" aria-label="Manage Pictures">
          <h3>Manage Pictures</h3>
          <div id="admin-pictures-list" style="margin-top: 12px; max-height: 250px; overflow-y: auto; border: 1px solid #d1d5db; border-radius: 12px; padding: 12px;">
            <!-- Pictures in use or uploaded -->
          </div>

          <form id="picture-upload-form" style="margin-top: 16px;" aria-label="Upload new picture form">
            <div class="form-group">
              <label for="picture-upload-input">Upload Picture (JPG, PNG, max 2MB):</label>
              <input id="picture-upload-input" type="file" accept="image/png, image/jpeg" />
            </div>
            <button type="submit" class="btn-primary">Upload Picture</button>
          </form>
        </section>

        <section class="admin-section" aria-label="Logout">
          <button id="btn-logout" type="button" class="btn-danger">Logout Admin</button>
        </section>
      </div>
    </section>
  </main>

  <footer role="contentinfo">
    <div class="container" tabindex="-1">
      &copy; 2025 Football Grader. Crafted with modern web standards.
    </div>
  </footer>

<script>
  (() => {
    "use strict";

    // Data store keys
    const STORAGE_KEYS = {
      players: 'football_grader_players',
      blogs: 'football_grader_blogs',
      pictures: 'football_grader_pictures',
      comments: 'football_grader_comments',
      admin_pass: 'football_grader_admin_pass',
      admin_logged_in: 'football_grader_admin_logged_in',
    };

    // Default admin password (hashed or plaintext here? We'll store in localStorage plaintext for demo; in real app hashing needed)
    const DEFAULT_ADMIN_PASSWORD = 'admin123'; // Should prompt user to change after first login in real life

    // Threat levels and colors for UI
    const THREAT_LEVELS = ['god','dragon','demon','tiger','wolf'];
    // Map threat name to class for badge color
    const THREAT_COLORS = {
      god: 'threat-god',
      dragon: 'threat-dragon',
      demon: 'threat-demon',
      tiger: 'threat-tiger',
      wolf: 'threat-wolf',
    };

    // Demo initial data for players
    const DEMO_PLAYERS = [
      {
        id: 'p1',
        name: 'Adimulia Danendra Iskandar',
        grade: 'S',
        skill: ['flick up', 'rainbow flick'],
        shootingSkill: ['trivela', 'rabona', 'kaiser impact'],
        agility: 80,
        defence: 95,
        sanity: 75,
        threat: 'dragon',
        durability: 92.5,
        maxSpeed: 28,
        footballIQ: 120,
        bestOn: 'futsal',
        pictureUrl: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/443a7375-f848-4fd6-852a-1cefbcc67e91.png',
      }
    ];

    // Demo initial data for blogs
    const DEMO_BLOGS = [
      {
        id: 'b1',
        title: 'Welcome to Football Grader',
        date: (new Date()).toISOString(),
        content: 'This is the first blog post on Football Grader! Here you can find the best football players graded and analyzed carefully.',
        imageUrl: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/e6e50ecc-2628-4f35-b97a-b5100f777681.png',
      }
    ];

    // Icon mapping for skill tags - using Material icons fallback for simplicity
    const SKILL_ICONS = {
      'flick up': 'sports_soccer',
      'rainbow flick': 'flare',
      'trivela': 'sports_soccer',
      'rabona': 'star',
      'kaiser impact': 'bolt',
    };

    // Global state
    let state = {
      players: [],
      blogs: [],
      pictures: [],
      comments: {},
      adminLoggedIn: false,
    };

    // Utility: Generate unique ID for new entries
    function genId(prefix = 'id') {
      return prefix + '_' + Math.random().toString(36).substr(2, 9);
    }

    // Load data from localStorage or initialize defaults
    function loadData() {
      let storedPlayers = localStorage.getItem(STORAGE_KEYS.players);
      if (storedPlayers) {
        try {
          state.players = JSON.parse(storedPlayers);
        } catch {
          state.players = [];
        }
      } else {
        state.players = DEMO_PLAYERS;
        savePlayers();
      }

      let storedBlogs = localStorage.getItem(STORAGE_KEYS.blogs);
      if (storedBlogs) {
        try {
          state.blogs = JSON.parse(storedBlogs);
        } catch {
          state.blogs = [];
        }
      } else {
        state.blogs = DEMO_BLOGS;
        saveBlogs();
      }

      let storedPictures = localStorage.getItem(STORAGE_KEYS.pictures);
      if (storedPictures) {
        try {
          state.pictures = JSON.parse(storedPictures);
        } catch {
          state.pictures = [];
        }
      } else {
        state.pictures = DEMO_PLAYERS.map(p => ({id: p.id + '_pic', url: p.pictureUrl}));
        savePictures();
      }

      // Comments: object with key=playerId, value=array comments
      let storedComments = localStorage.getItem(STORAGE_KEYS.comments);
      if (storedComments) {
        try {
          state.comments = JSON.parse(storedComments);
        } catch {
          state.comments = {};
        }
      } else {
        state.comments = {};
        saveComments();
      }

      // Admin login state
      state.adminLoggedIn = localStorage.getItem(STORAGE_KEYS.admin_logged_in) === 'true';

      // If no stored admin pass, save default pass to storage for future use
      if (!localStorage.getItem(STORAGE_KEYS.admin_pass)) {
        localStorage.setItem(STORAGE_KEYS.admin_pass, DEFAULT_ADMIN_PASSWORD);
      }
    }

    // Save data to localStorage functions
    function savePlayers() {
      localStorage.setItem(STORAGE_KEYS.players, JSON.stringify(state.players));
    }
    function saveBlogs() {
      localStorage.setItem(STORAGE_KEYS.blogs, JSON.stringify(state.blogs));
    }
    function savePictures() {
      localStorage.setItem(STORAGE_KEYS.pictures, JSON.stringify(state.pictures));
    }
    function saveComments() {
      localStorage.setItem(STORAGE_KEYS.comments, JSON.stringify(state.comments));
    }
    function setAdminLoggedIn(val) {
      state.adminLoggedIn = val;
      localStorage.setItem(STORAGE_KEYS.admin_logged_in, val ? 'true' : 'false');
    }

    // Template renderers
    const playerListEl = document.getElementById('player-list');
    const blogListEl = document.getElementById('blog-list');
    const adminPlayerListEl = document.getElementById('admin-player-list');
    const adminBlogListEl = document.getElementById('admin-blog-list');
    const adminPicturesListEl = document.getElementById('admin-pictures-list');
    const adminPanelContentEl = document.getElementById('admin-panel-content');
    const adminLoginContainerEl = document.getElementById('admin-login-container');
    const adminLoginForm = document.getElementById('admin-login-form');
    const adminPasswordInput = document.getElementById('admin-password');
    const pictureUploadForm = document.getElementById('picture-upload-form');
    const pictureUploadInput = document.getElementById('picture-upload-input');

    // Utility: format date for blog
    function formatDate(isoStr) {
      const d = new Date(isoStr);
      return d.toLocaleDateString(undefined, {year:'numeric', month: 'long', day: 'numeric'});
    }

    // Escape HTML (for comments/input)
    function escapeHtml(text) {
      if (!text) return '';
      return text.replace(/[&<>"']/g, (m) => {
        switch(m) {
          case '&': return '&amp;';
          case '<': return '&lt;';
          case '>': return '&gt;';
          case '"': return '&quot;';
          case '\'': return '&#039;';
          default: return m;
        }
      });
    }

    // Render all players in main view
    function renderPlayers() {
      playerListEl.innerHTML = '';
      if(!state.players.length) {
        playerListEl.innerHTML = '<p style="font-weight:600; text-align:center; color:#6b7280;">No players available</p>';
        return;
      }
      state.players.forEach(player => {
        const playerComments = state.comments[player.id] || [];
        const skillTags = player.skill.map(s => `<span class="skill-tag" title="${escapeHtml(s)}">${escapeHtml(s)}</span>`).join('');
        const shootingTags = player.shootingSkill.map(s => `<span class="skill-tag" title="${escapeHtml(s)}">${escapeHtml(s)}</span>`).join('');
        const threatClass = THREAT_COLORS[player.threat.toLowerCase()] || 'threat-wolf';

        // Build player card HTML
        const playerCard = document.createElement('article');
        playerCard.className = 'player-card';
        playerCard.setAttribute('tabindex', '0');
        playerCard.setAttribute('aria-label', `Player profile: ${player.name}, Grade ${player.grade}`);

        playerCard.innerHTML = `
          <div class="player-header">
            <img        
              src="${escapeHtml(player.pictureUrl || 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/f593b53d-3434-44a2-884c-ee0c87a89020.png')}" 
              alt="Photo of ${escapeHtml(player.name)}"
              class="player-image"
              onerror="this.onerror=null;this.src='https://placehold.co/72x72/png?text=No+Img&font=Inter&font-size=14&bg=9ca3af&color=ffffff';" />
            <div class="player-info">
              <h3 class="player-name">${escapeHtml(player.name)}</h3>
              <div class="player-grade" aria-label="Player grade">Grade: ${escapeHtml(player.grade)}</div>
              <div class="threat-level ${threatClass}" aria-label="Threat level: ${escapeHtml(player.threat)}">
                <span class="material-icons" aria-hidden="true">priority_high</span>
                ${escapeHtml(player.threat.charAt(0).toUpperCase() + player.threat.slice(1))}
              </div>
            </div>
          </div>
          <div>
            <div class="attribute"><span class="attribute-label">Agility</span> ${player.agility}</div>
            <div class="attribute"><span class="attribute-label">Defence</span> ${player.defence}</div>
            <div class="attribute"><span class="attribute-label">Sanity</span> ${player.sanity}</div>
            <div class="attribute"><span class="attribute-label">Durability</span> ${player.durability}</div>
            <div class="attribute"><span class="attribute-label">Max Speed (km/h)</span> ${player.maxSpeed}</div>
            <div class="attribute"><span class="attribute-label">Football IQ</span> ${player.footballIQ}</div>
            <div class="attribute"><span class="attribute-label">Best On</span> ${escapeHtml(player.bestOn)}</div>
          </div>
          <div style="margin-top: 12px;">
            <strong>Skills:</strong>
            <div class="skills-list" aria-label="Skills">${skillTags}</div>
          </div>
          <div style="margin-top: 8px;">
            <strong>Shooting Skill:</strong>
            <div class="skills-list" aria-label="Shooting skills">${shootingTags}</div>
          </div>

          <section class="comments-section" aria-label="Comments for player ${escapeHtml(player.name)}">
            <div class="comments-title" id="comments-title-${player.id}">Comments (${playerComments.length})</div>
            <div class="comment-list" id="comment-list-${player.id}" tabindex="0" aria-live="polite" aria-relevant="additions">
              ${playerComments.length === 0 ? '<p style="color:#6b7280; font-style:italic;">No comments yet.</p>' : playerComments.map(c => `
                <div class="comment-item">${escapeHtml(c)}</div>
              `).join('')}
            </div>
            <form class="comment-form" data-player-id="${player.id}" aria-describedby="comments-title-${player.id}">
              <label for="comment-input-${player.id}" class="sr-only">Add comment for ${escapeHtml(player.name)}</label>
              <textarea id="comment-input-${player.id}" aria-label="Comment input for ${escapeHtml(player.name)}" placeholder="Add a comment..." required></textarea>
              <button type="submit" disabled aria-label="Submit comment for ${escapeHtml(player.name)}">Send</button>
            </form>
          </section>
        `;
        playerListEl.appendChild(playerCard);

        // Add event listeners for comment form enable/disable and submit after insertion
        const form = playerCard.querySelector('form.comment-form');
        const textarea = form.querySelector('textarea');
        const submitBtn = form.querySelector('button[type="submit"]');

        textarea.addEventListener('input', () => {
          submitBtn.disabled = !textarea.value.trim();
        });
        form.addEventListener('submit', e => {
          e.preventDefault();
          const text = textarea.value.trim();
          if (text) {
            addComment(player.id, text);
            textarea.value = '';
            submitBtn.disabled = true;
          }
        });
      });
    }

    // Add comment for player
    function addComment(playerId, commentText) {
      if (!state.comments[playerId]) state.comments[playerId] = [];
      state.comments[playerId].push(commentText);
      saveComments();
      renderPlayers();
    }

    // Render blogs
    function renderBlogs() {
      blogListEl.innerHTML = '';
      if (!state.blogs.length) {
        blogListEl.innerHTML = '<p style="font-weight:600; text-align:center; color:#6b7280;">No blogs available</p>';
        return;
      }
      state.blogs.forEach(blog => {
        const blogPost = document.createElement('article');
        blogPost.className = 'blog-post';
        blogPost.setAttribute('tabindex', '0');
        blogPost.setAttribute('aria-label', `Blog post titled ${blog.title}`);

        blogPost.innerHTML = `
          <h2 class="blog-title">${escapeHtml(blog.title)}</h2>
          <time class="blog-date" datetime="${escapeHtml(blog.date)}">${formatDate(blog.date)}</time>
          <div class="blog-content">${escapeHtml(blog.content)}</div>
          ${blog.imageUrl ? `<div class="blog-image-container"><img src="${escapeHtml(blog.imageUrl)}" alt="Blog image for ${escapeHtml(blog.title)}" class="blog-image" loading="lazy" onerror="this.onerror=null;this.src='https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/f8fb03ad-9eb6-4c83-a9da-0466d2b2c474.png';" /></div>` : ''}
        `;
        blogListEl.appendChild(blogPost);
      });
    }

    // Admin panel renders

    // Render admin player list with editable inputs and delete buttons
    function renderAdminPlayers() {
      adminPlayerListEl.innerHTML = '';
      if (!state.players.length) {
        adminPlayerListEl.innerHTML = '<p style="font-weight:600; text-align:center; color:#6b7280;">No players available</p>';
        return;
      }
      state.players.forEach((player, index) => {
        const playerId = player.id;
        // Create container div
        const item = document.createElement('div');
        item.className = 'list-item';
        item.setAttribute('data-player-id', playerId);

        // Build inner editable structure
        item.innerHTML = `
          <div>
            <label for="admin-player-name-${playerId}">Name</label>
            <input type="text" id="admin-player-name-${playerId}" value="${escapeHtml(player.name)}" />
          </div>
          <div>
            <label for="admin-player-grade-${playerId}">Grade</label>
            <input type="text" id="admin-player-grade-${playerId}" maxlength="2" style="width: 48px;" value="${escapeHtml(player.grade)}" />
          </div>
          <div>
            <label for="admin-player-picture-${playerId}">Picture URL</label>
            <input type="text" id="admin-player-picture-${playerId}" value="${escapeHtml(player.pictureUrl || '')}" placeholder="https://example.com/image.png" />
          </div>
          <div>
            <label for="admin-player-threat-${playerId}">Threat Level</label>
            <select id="admin-player-threat-${playerId}" aria-label="Select threat level">
              ${THREAT_LEVELS.map(t => `<option value="${t}" ${player.threat === t ? 'selected' : ''}>${t.charAt(0).toUpperCase() + t.slice(1)}</option>`).join('')}
            </select>
          </div>
          <div>
            <label for="admin-player-bestOn-${playerId}">Best On</label>
            <input type="text" id="admin-player-bestOn-${playerId}" value="${escapeHtml(player.bestOn)}" />
          </div>
          <div>
            <label for="admin-player-agility-${playerId}">Agility</label>
            <input type="number" id="admin-player-agility-${playerId}" min="0" max="100" value="${player.agility}" />
          </div>
          <div>
            <label for="admin-player-defence-${playerId}">Defence</label>
            <input type="number" id="admin-player-defence-${playerId}" min="0" max="100" value="${player.defence}" />
          </div>
          <div>
            <label for="admin-player-sanity-${playerId}">Sanity</label>
            <input type="number" id="admin-player-sanity-${playerId}" min="0" max="100" value="${player.sanity}" />
          </div>
          <div>
            <label for="admin-player-durability-${playerId}">Durability</label>
            <input type="number" id="admin-player-durability-${playerId}" min="0" max="100" step="0.1" value="${player.durability}" />
          </div>
          <div>
            <label for="admin-player-maxSpeed-${playerId}">Max Speed (km/h)</label>
            <input type="number" id="admin-player-maxSpeed-${playerId}" min="0" max="50" step="0.1" value="${player.maxSpeed}" />
          </div>
          <div>
            <label for="admin-player-footballIQ-${playerId}">Football IQ</label>
            <input type="number" id="admin-player-footballIQ-${playerId}" min="0" max="250" value="${player.footballIQ}" />
          </div>
          <div>
            <label for="admin-player-skill-${playerId}">Skills (comma separated)</label>
            <input type="text" id="admin-player-skill-${playerId}" value="${escapeHtml(player.skill.join(', '))}" />
          </div>
          <div>
            <label for="admin-player-shootingSkill-${playerId}">Shooting Skills (comma separated)</label>
            <input type="text" id="admin-player-shootingSkill-${playerId}" value="${escapeHtml(player.shootingSkill.join(', '))}" />
          </div>
        `;

        // Actions container with delete button
        const actionsDiv = document.createElement('div');
        actionsDiv.className = 'list-item-actions';

        const saveBtn = document.createElement('button');
        saveBtn.type = 'button';
        saveBtn.className = 'btn-primary icon-button';
        saveBtn.title = `Save changes for ${player.name}`;
        saveBtn.setAttribute('aria-label', `Save changes for player ${player.name}`);
        saveBtn.innerHTML = '<span class="material-icons">save</span>';

        saveBtn.addEventListener('click', () => {
          // Collect data and save
          const updatedPlayer = {
            ...player,
            name: item.querySelector(`#admin-player-name-${playerId}`).value.trim(),
            grade: item.querySelector(`#admin-player-grade-${playerId}`).value.trim(),
            pictureUrl: item.querySelector(`#admin-player-picture-${playerId}`).value.trim(),
            threat: item.querySelector(`#admin-player-threat-${playerId}`).value,
            bestOn: item.querySelector(`#admin-player-bestOn-${playerId}`).value.trim(),
            agility: Number(item.querySelector(`#admin-player-agility-${playerId}`).value),
            defence: Number(item.querySelector(`#admin-player-defence-${playerId}`).value),
            sanity: Number(item.querySelector(`#admin-player-sanity-${playerId}`).value),
            durability: parseFloat(item.querySelector(`#admin-player-durability-${playerId}`).value),
            maxSpeed: Number(item.querySelector(`#admin-player-maxSpeed-${playerId}`).value),
            footballIQ: Number(item.querySelector(`#admin-player-footballIQ-${playerId}`).value),
            skill: item.querySelector(`#admin-player-skill-${playerId}`).value.split(',').map(s => s.trim()).filter(Boolean),
            shootingSkill: item.querySelector(`#admin-player-shootingSkill-${playerId}`).value.split(',').map(s => s.trim()).filter(Boolean),
          };
          if (!updatedPlayer.name) {
            alert('Player name cannot be empty.');
            return;
          }
          // Save update
          state.players[index] = updatedPlayer;
          savePlayers();
          renderPlayers();
          alert(`Player '${updatedPlayer.name}' saved.`);
        });

        const deleteBtn = document.createElement('button');
        deleteBtn.type = 'button';
        deleteBtn.className = 'btn-danger icon-button';
        deleteBtn.title = `Delete player ${player.name}`;
        deleteBtn.setAttribute('aria-label', `Delete player ${player.name}`);
        deleteBtn.innerHTML = '<span class="material-icons">delete</span>';
        deleteBtn.addEventListener('click', () => {
          if (confirm(`Delete player "${player.name}"? This action cannot be undone.`)) {
            state.players.splice(index, 1);
            // Also delete comments of player
            delete state.comments[player.id];
            savePlayers();
            saveComments();
            renderPlayers();
            renderAdminPlayers();
            alert(`Player '${player.name}' deleted.`);
          }
        });

        actionsDiv.appendChild(saveBtn);
        actionsDiv.appendChild(deleteBtn);

        item.appendChild(actionsDiv);
        adminPlayerListEl.appendChild(item);
      });
    }

    // Render blogs in admin panel as editable
    function renderAdminBlogs() {
      adminBlogListEl.innerHTML = '';
      if (!state.blogs.length) {
        adminBlogListEl.innerHTML = '<p style="font-weight:600; text-align:center; color:#6b7280;">No blogs available</p>';
        return;
      }
      state.blogs.forEach((blog, index) => {
        const blogId = blog.id;
        const item = document.createElement('div');
        item.className = 'list-item';
        item.setAttribute('data-blog-id', blogId);
        item.style.flexDirection = 'column';

        item.innerHTML = `
          <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
            <div style="flex:1 1 40%;">
              <label for="admin-blog-title-${blogId}">Title</label>
              <input type="text" id="admin-blog-title-${blogId}" value="${escapeHtml(blog.title)}" />
            </div>
            <div style="flex:1 1 30%;">
              <label for="admin-blog-date-${blogId}">Date</label>
              <input type="date" id="admin-blog-date-${blogId}" value="${blog.date.slice(0,10)}" />
            </div>
            <div style="flex:1 1 25%;">
              <label for="admin-blog-image-${blogId}">Image URL</label>
              <input type="text" id="admin-blog-image-${blogId}" value="${escapeHtml(blog.imageUrl || '')}" placeholder="https://example.com/img.png" />
            </div>
          </div>
          <div style="margin-top:12px; flex:1; width:100%;">
            <label for="admin-blog-content-${blogId}">Content</label>
            <textarea id="admin-blog-content-${blogId}" style="width:100%;min-height:120px;">${escapeHtml(blog.content)}</textarea>
          </div>
        `;

        const actionsDiv = document.createElement('div');
        actionsDiv.className = 'list-item-actions';
        actionsDiv.style.marginTop = '12px';

        const saveBtn = document.createElement('button');
        saveBtn.type = 'button';
        saveBtn.className = 'btn-primary icon-button';
        saveBtn.title = `Save changes for blog '${blog.title}'`;
        saveBtn.setAttribute('aria-label', `Save changes for blog ${blog.title}`);
        saveBtn.innerHTML = '<span class="material-icons">save</span>';
        saveBtn.addEventListener('click', () => {
          const updatedBlog = {
            ...blog,
            title: item.querySelector(`#admin-blog-title-${blogId}`).value.trim(),
            date: item.querySelector(`#admin-blog-date-${blogId}`).value,
            imageUrl: item.querySelector(`#admin-blog-image-${blogId}`).value.trim(),
            content: item.querySelector(`#admin-blog-content-${blogId}`).value.trim(),
          };
          if (!updatedBlog.title) {
            alert('Blog title cannot be empty.');
            return;
          }
          if (!updatedBlog.date) {
            alert('Blog date is required.');
            return;
          }
          state.blogs[index] = updatedBlog;
          saveBlogs();
          renderBlogs();
          alert(`Blog '${updatedBlog.title}' saved.`);
        });

        const deleteBtn = document.createElement('button');
        deleteBtn.type = 'button';
        deleteBtn.className = 'btn-danger icon-button';
        deleteBtn.title = `Delete blog '${blog.title}'`;
        deleteBtn.setAttribute('aria-label', `Delete blog ${blog.title}`);
        deleteBtn.innerHTML = '<span class="material-icons">delete</span>';
        deleteBtn.addEventListener('click', () => {
          if (confirm(`Delete blog "${blog.title}"? This action cannot be undone.`)) {
            state.blogs.splice(index, 1);
            saveBlogs();
            renderBlogs();
            renderAdminBlogs();
            alert(`Blog '${blog.title}' deleted.`);
          }
        });

        actionsDiv.appendChild(saveBtn);
        actionsDiv.appendChild(deleteBtn);

        item.appendChild(actionsDiv);
        adminBlogListEl.appendChild(item);
      });
    }

    // Render uploaded pictures in admin panel with delete capability
    function renderAdminPictures() {
      adminPicturesListEl.innerHTML = '';
      if (!state.pictures.length) {
        adminPicturesListEl.innerHTML = '<p style="font-weight:600; text-align:center; color:#6b7280;">No pictures uploaded</p>';
        return;
      }
      state.pictures.forEach((pic, index) => {
        const picId = pic.id;
        const picDiv = document.createElement('div');
        picDiv.style.display = 'flex';
        picDiv.style.alignItems = 'center';
        picDiv.style.justifyContent = 'space-between';
        picDiv.style.marginBottom = '10px';

        const imgThumb = document.createElement('img');
        imgThumb.src = pic.url;
        imgThumb.alt = `Uploaded picture preview`;
        imgThumb.style.width = '64px';
        imgThumb.style.height = '64px';
        imgThumb.style.borderRadius = '12px';
        imgThumb.style.objectFit = 'cover';
        imgThumb.style.border = '1px solid #d1d5db';

        const removeBtn = document.createElement('button');
        removeBtn.type = 'button';
        removeBtn.className = 'btn-danger';
        removeBtn.style.flexShrink = '0';
        removeBtn.textContent = 'Delete';
        removeBtn.title = 'Delete this picture';
        removeBtn.addEventListener('click', () => {
          if (confirm('Delete this picture? This cannot be undone.')){
            state.pictures.splice(index, 1);
            savePictures();
            renderAdminPictures();
            alert('Picture deleted.');
          }
        });

        picDiv.appendChild(imgThumb);
        picDiv.appendChild(removeBtn);
        adminPicturesListEl.appendChild(picDiv);
      });
    }

    // Add new player form dialog (simple modal or inline form)
    function addNewPlayer() {
      const newId = genId('p');
      const newPlayer = {
        id: newId,
        name: 'New Player',
        grade: 'C',
        skill: [],
        shootingSkill: [],
        agility: 50,
        defence: 50,
        sanity: 50,
        threat: 'wolf',
        durability: 50,
        maxSpeed: 20,
        footballIQ: 80,
        bestOn: 'field',
        pictureUrl: '',
      };
      state.players.push(newPlayer);
      savePlayers();
      renderPlayers();
      renderAdminPlayers();
      alert('New player added. Edit their details below.');
    }

    // Add new blog function
    function addNewBlog() {
      const newId = genId('b');
      const newBlog = {
        id: newId,
        title: 'New blog post',
        date: new Date().toISOString().slice(0,10),
        content: '',
        imageUrl: '',
      };
      state.blogs.push(newBlog);
      saveBlogs();
      renderBlogs();
      renderAdminBlogs();
      alert('New blog post added. Edit its details below.');
    }

    // Admin login handler
    function handleAdminLogin(e) {
      e.preventDefault();
      const enteredPass = adminPasswordInput.value.trim();
      const storedPass = localStorage.getItem(STORAGE_KEYS.admin_pass) || DEFAULT_ADMIN_PASSWORD;
      if(enteredPass === storedPass){
        setAdminLoggedIn(true);
        alert('Admin login successful.');
        adminPasswordInput.value = '';
        showAdminPanel(true);
      } else {
        alert('Incorrect admin password. Try again.');
      }
    }

    // Admin logout
    function adminLogout() {
      if(!confirm('Logout admin?')) return;
      setAdminLoggedIn(false);
      showAdminPanel(false);
      alert('Admin logged out.');
    }

    // Toggle showing admin panel or login form
    function showAdminPanel(show) {
      if(show){
        adminPanelContentEl.style.display = 'block';
        adminLoginContainerEl.style.display = 'none';
      } else {
        adminPanelContentEl.style.display = 'none';
        adminLoginContainerEl.style.display = 'block';
      }
    }

    // Upload picture handler for admin
    async function handlePictureUpload(e) {
      e.preventDefault();
      const file = pictureUploadInput.files[0];
      if(!file){
        alert('Please select a file to upload.');
        return;
      }
      if(!file.type.startsWith('image/')){
        alert('Only image files (jpg, png) are allowed.');
        return;
      }
      if(file.size > 2 * 1024 * 1024){
        alert('Maximum file size allowed is 2MB.');
        return;
      }

      // Read file as Data URL and save to pictures list
      const reader = new FileReader();
      reader.onload = function(evt){
        const url = evt.target.result;
        const id = genId('pic');
        state.pictures.push({id, url});
        savePictures();
        renderAdminPictures();
        alert('Picture uploaded successfully.');
        pictureUploadInput.value = '';
      };
      reader.readAsDataURL(file);
    }

    // Navigation tab buttons (Players, Blogs, Admin)
    const tabs = [
      {btn: document.getElementById('btn-players'), section: document.getElementById('players-section')},
      {btn: document.getElementById('btn-blogs'), section: document.getElementById('blogs-section')},
      {btn: document.getElementById('btn-admin'), section: document.getElementById('admin-section')},
    ];
    function switchTab(selectedBtn) {
      tabs.forEach(({btn, section}) => {
        const isSelected = btn === selectedBtn;
        btn.setAttribute('aria-pressed', isSelected.toString());
        if (isSelected){
          section.removeAttribute('hidden');
          section.focus();
        } else {
          section.setAttribute('hidden', 'true');
        }
      });
      if (selectedBtn === tabs[2].btn){
        // Admin tab clicked, show correct admin panel view depending on login state
        showAdminPanel(state.adminLoggedIn);
      }
      location.hash = selectedBtn.id.replace(/^btn-/, '');
    }

    // Initialize tab from URL hash or default to players
    function initTabFromHash() {
      const hash = location.hash.replace('#','');
      const tabBtn = tabs.find(t => t.btn.id.endsWith(hash));
      if(tabBtn){
        switchTab(tabBtn.btn);
      } else {
        switchTab(tabs[0].btn);
      }
    }

    // Initialization
    function init() {
      loadData();
      renderPlayers();
      renderBlogs();
      renderAdminPlayers();
      renderAdminBlogs();
      renderAdminPictures();

      // Setup tab nav events
      tabs.forEach(({btn}) => {
        btn.addEventListener('click', () => switchTab(btn));
      });
      initTabFromHash();

      // Admin login form submit
      adminLoginForm.addEventListener('submit', handleAdminLogin);

      // Admin logout button
      document.getElementById('btn-logout').addEventListener('click', adminLogout);

      // Add new player
      document.getElementById('btn-add-player').addEventListener('click', addNewPlayer);

      // Add new blog
      document.getElementById('btn-add-blog').addEventListener('click', addNewBlog);

      // Picture upload
      pictureUploadForm.addEventListener('submit', handlePictureUpload);

      // Comment form submit delegation for dynamically rendered comments for players
      playerListEl.addEventListener('submit', e => {
        if (!e.target.classList.contains('comment-form')) return;
        e.preventDefault();
        const form = e.target;
        const playerId = form.getAttribute('data-player-id');
        const textarea = form.querySelector('textarea');
        const text = textarea.value.trim();
        if (text && playerId) {
          addComment(playerId, text);
          textarea.value = '';
          form.querySelector('button[type="submit"]').disabled = true;
        }
      });

      // Enable submit button when typing in any comment form (delegated)
      playerListEl.addEventListener('input', e => {
        if (!(e.target.tagName === 'TEXTAREA' && e.target.closest('form.comment-form'))) return;
        const form = e.target.closest('form.comment-form');
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.disabled = !e.target.value.trim();
      });

      // Keyboard accessibility adjustment: focus outline visible only on keyboard interaction
      function handleFirstTab(e) {
        if(e.key === 'Tab') {
          document.body.classList.add('user-is-tabbing');
          window.removeEventListener('keydown', handleFirstTab);
        }
      }
      window.addEventListener('keydown', handleFirstTab);
      // Remove outline on mouse click to prevent
      window.addEventListener('mousedown', () => {
        document.body.classList.remove('user-is-tabbing');
      })
    }

    // Run init on DOM ready
    document.addEventListener('DOMContentLoaded', init);

  })();
</script>
</body>
</html>


